<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> LightGBM usage and implementation | Zhutao Zhuang </title> <meta name="author" content="Zhutao Zhuang"> <meta name="description" content="Artificial Intelligence"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bilyz98.github.io/blog/2024/lightgbm-usage/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Zhutao</span> Zhuang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">LightGBM usage and implementation</h1> <p class="post-meta"> Created in June 08, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/ai"> <i class="fa-solid fa-hashtag fa-sm"></i> ai</a>   <a href="/blog/tag/ml"> <i class="fa-solid fa-hashtag fa-sm"></i> ml</a>   ·   <a href="/blog/category/ai"> <i class="fa-solid fa-tag fa-sm"></i> ai</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="lightgbm">LightGBM</h1> <h2 id="lightgbm-pay-more-attention-minority-class">LightGBM pay more attention minority class</h2> <p>In LightGBM, there are several ways to handle imbalanced data and pay more attention to the minority class:</p> <p>is_unbalance parameter: You can set the is_unbalance parameter to true when training the LightGBM model. This will automatically adjust the weights of the classes to be inversely proportional to their frequencies1. scale_pos_weight parameter: This parameter can provide better control of the weights of the minority and majority classes1. It allows you to set a configurable weight for the minority class1. class_weight parameter: This parameter is available in the LGBMClassifier and can be used to directly handle imbalanced data2. Customized metric or sample weights: You can also use a customized metric or apply weights to your samples3. Remember, when dealing with imbalanced data, accuracy is not the best metric. Instead, consider using metrics such as recall, precision, F1 score, or AUC4. You can also use ‘weighted’ or ‘micro’ averaging methods4.</p> <p>Here’s a simple example of how you might use the is_unbalance parameter in the C API:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;LightGBM/c_api.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">param</span> <span class="o">=</span> <span class="s">"objective=binary is_unbalance=true"</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">train_data_filename</span> <span class="o">=</span> <span class="s">"train.txt"</span><span class="p">;</span>
    <span class="n">DatasetHandle</span> <span class="n">train_data</span><span class="p">;</span>
    <span class="n">BoosterHandle</span> <span class="n">booster</span><span class="p">;</span>

    <span class="c1">// Load training data</span>
    <span class="n">LGBM_DatasetCreateFromFile</span><span class="p">(</span><span class="n">train_data_filename</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">train_data</span><span class="p">);</span>

    <span class="c1">// Create booster</span>
    <span class="n">LGBM_BoosterCreate</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">booster</span><span class="p">);</span>

    <span class="c1">// Train model</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LGBM_BoosterUpdateOneIter</span><span class="p">(</span><span class="n">booster</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Save model</span>
    <span class="n">LGBM_BoosterSaveModel</span><span class="p">(</span><span class="n">booster</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">"LightGBM_model.txt"</span><span class="p">);</span>

    <span class="c1">// Free resources</span>
    <span class="n">LGBM_BoosterFree</span><span class="p">(</span><span class="n">booster</span><span class="p">);</span>
</code></pre></div></div> <h2 id="id3-algorithm-that-trains-decision-tree">ID3 algorithm that trains decision tree</h2> <p>The training process of a decision tree involves building the tree and determining the split points of the features that most effectively separate the data. Here’s a simplified example of how a decision tree might be trained using the ID3 algorithm:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ID3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">original_data</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target_attribute_name</span><span class="o">=</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">,</span> <span class="n">parent_node_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># If all target_values have the same value, return this value
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># If the dataset is empty, return the mode target feature value in the original dataset
</span>    <span class="k">elif</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">original_data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">])[</span><span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">original_data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="c1"># If the feature space is empty, return the mode target feature value of the direct parent node
</span>    <span class="k">elif</span> <span class="nf">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parent_node_class</span>

    <span class="c1"># If none of the above holds true, grow the tree!
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">parent_node_class</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">])[</span><span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_attribute_name</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Select the feature which best splits the dataset
</span>        <span class="n">item_values</span> <span class="o">=</span> <span class="p">[</span><span class="nc">InfoGain</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">target_attribute_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">best_feature_index</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">item_values</span><span class="p">)</span>
        <span class="n">best_feature</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">best_feature_index</span><span class="p">]</span>

        <span class="c1"># Create the tree structure
</span>        <span class="n">tree</span> <span class="o">=</span> <span class="p">{</span><span class="n">best_feature</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Remove the feature with the best info gain from the feature space
</span>        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">best_feature</span><span class="p">]</span>

        <span class="c1"># Grow a branch under the root node for each possible value of the root node feature
</span>        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">best_feature</span><span class="p">]):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">sub_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">best_feature</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">).</span><span class="nf">dropna</span><span class="p">()</span>

            <span class="c1"># Call the ID3 algorithm for each of those sub_datasets with the new parameters
</span>            <span class="n">subtree</span> <span class="o">=</span> <span class="nc">ID3</span><span class="p">(</span><span class="n">sub_data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target_attribute_name</span><span class="p">,</span> <span class="n">parent_node_class</span><span class="p">)</span>

            <span class="c1"># Add the sub tree, grown from the sub_dataset to the tree under the root node
</span>            <span class="n">tree</span><span class="p">[</span><span class="n">best_feature</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtree</span>

        <span class="k">return</span> <span class="n">tree</span>
</code></pre></div></div> <p>In this code, the ID3 function is a recursive function that builds a decision tree using the ID3 algorithm. The function takes as input a dataset, a list of features to consider for splitting, and the name of the target attribute. It also takes an optional argument parent_node_class that is used to determine the class label for a node when no further splitting can be done.</p> <p>The function works by first checking for the base cases that would terminate the recursion: all instances having the same class, no more instances left, no more features left, or no more value left for the feature to split upon. If none of these cases are met, it calculates the information gain of the features and selects the feature with the highest information gain to split upon. It then creates a new tree node for this feature and calls the ID3 function recursively on the sub-datasets to build the subtrees.</p> <p>Please note that this is a simplified example. Real-world decision tree learning algorithms like those used in scikit-learn or LightGBM are more complex and optimized. They also handle more cases, like missing values and different types of features (continuous, categorical, etc.). They also use different criteria for splitting, like Gini impurity or information gain ratio. The ID3 algorithm is one of the simplest decision tree learning algorithms and is a good starting point for understanding the basics.</p> <h2 id="code-example-of-calling-lgbm_boosterpredictforcsrsinglerowfast">Code example of calling LGBM_BoosterPredictForCSRSingleRowFast</h2> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;lightgbm/c_api.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Assume we have a trained model and a FastConfigHandle</span>
    <span class="n">FastConfigHandle</span> <span class="n">fastConfig_handle</span><span class="p">;</span>

    <span class="c1">// Define a single row of data in CSR format</span>
    <span class="kt">int</span> <span class="n">indptr_type</span> <span class="o">=</span> <span class="n">C_API_DTYPE_INT32</span><span class="p">;</span>
    <span class="kt">int64_t</span> <span class="n">nindptr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int64_t</span> <span class="n">nelem</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">indptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">nindptr</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">indptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">indptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nelem</span><span class="p">;</span>

    <span class="kt">int32_t</span><span class="o">*</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int32_t</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">nelem</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">));</span>
    <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="kt">double</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">nelem</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Output variables</span>
    <span class="kt">int64_t</span> <span class="n">out_len</span><span class="p">;</span>
    <span class="kt">double</span><span class="o">*</span> <span class="n">out_result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

    <span class="c1">// Call the function</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">LGBM_BoosterPredictForCSRSingleRowFast</span><span class="p">(</span><span class="n">fastConfig_handle</span><span class="p">,</span> <span class="n">indptr</span><span class="p">,</span> <span class="n">indptr_type</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nindptr</span><span class="p">,</span> <span class="n">nelem</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out_len</span><span class="p">,</span> <span class="n">out_result</span><span class="p">);</span>

    <span class="c1">// Check the result</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prediction successful, output length: %lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">out_len</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prediction failed, error code: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Free allocated memory</span>
    <span class="n">free</span><span class="p">(</span><span class="n">indptr</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">indices</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">out_result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>In this example, we’re creating a single row of data with three non-zero elements. The <code class="language-plaintext highlighter-rouge">indptr</code> array defines the start and end of the row in the <code class="language-plaintext highlighter-rouge">indices</code> and <code class="language-plaintext highlighter-rouge">data</code> arrays. The <code class="language-plaintext highlighter-rouge">indices</code> array contains the column indices of the non-zero elements, and the <code class="language-plaintext highlighter-rouge">data</code> array contains the values of the non-zero elements.</p> <p>Please replace the placeholders with your actual data and handle. Also, make sure to handle the memory correctly, especially for the <code class="language-plaintext highlighter-rouge">out_result</code> pointer. This is just a basic example and does not include error checking or memory management. You should add those in your actual code.</p> <p>Remember to link against the LightGBM library when compiling this code. If you’re using gcc, you can do this with <code class="language-plaintext highlighter-rouge">-lLightGBM</code>. If you’re using Visual Studio, you’ll need to add the LightGBM library to your project settings.</p> <h2 id="source-code-of-gbdt-train">Source code of GBDT train()</h2> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">class</span> <span class="n">ObjectiveFunction</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="cm">/*! \brief virtual destructor */</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">ObjectiveFunction</span><span class="p">()</span> <span class="p">{}</span>

  <span class="cm">/*!
  * \brief Initialize
  * \param metadata Label data
  * \param num_data Number of data
  */</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Init</span><span class="p">(</span><span class="k">const</span> <span class="n">Metadata</span><span class="o">&amp;</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">data_size_t</span> <span class="n">num_data</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*!
  * \brief calculating first order derivative of loss function
  * \param score prediction score in this round
  * \gradients Output gradients
  * \hessians Output hessians
  */</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">GetGradients</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">score</span><span class="p">,</span>
    <span class="n">score_t</span><span class="o">*</span> <span class="n">gradients</span><span class="p">,</span> <span class="n">score_t</span><span class="o">*</span> <span class="n">hessians</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


</code></pre></div></div> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">GBDT</span><span class="o">::</span><span class="n">Train</span><span class="p">(</span><span class="kt">int</span> <span class="n">snapshot_freq</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">model_output_path</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Common</span><span class="o">::</span><span class="n">FunctionTimer</span> <span class="n">fun_timer</span><span class="p">(</span><span class="s">"GBDT::Train"</span><span class="p">,</span> <span class="n">global_timer</span><span class="p">);</span>
  <span class="n">bool</span> <span class="n">is_finished</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iter</span> <span class="o">&lt;</span> <span class="n">config_</span><span class="o">-&gt;</span><span class="n">num_iterations</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_finished</span><span class="p">;</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">is_finished</span> <span class="o">=</span> <span class="n">TrainOneIter</span><span class="p">(</span><span class="n">nullptr</span><span class="p">,</span> <span class="n">nullptr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_finished</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">is_finished</span> <span class="o">=</span> <span class="n">EvalAndCheckEarlyStopping</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">auto</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="c1">// output used time per iteration</span>
    <span class="n">Log</span><span class="o">::</span><span class="n">Info</span><span class="p">(</span><span class="s">"%f seconds elapsed, finished iteration %d"</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span>
              <span class="n">std</span><span class="o">::</span><span class="n">milli</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">snapshot_freq</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">snapshot_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">snapshot_out</span> <span class="o">=</span> <span class="n">model_output_path</span> <span class="o">+</span> <span class="s">".snapshot_iter_"</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">SaveModelToFile</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">config_</span><span class="o">-&gt;</span><span class="n">saved_feature_importance_type</span><span class="p">,</span> <span class="n">snapshot_out</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
    <span class="n">bool</span> <span class="n">GBDT</span><span class="o">::</span><span class="n">TrainOneIter</span><span class="p">(</span><span class="k">const</span> <span class="n">score_t</span><span class="o">*</span> <span class="n">gradients</span><span class="p">,</span> <span class="k">const</span> <span class="n">score_t</span><span class="o">*</span> <span class="n">hessians</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Common</span><span class="o">::</span><span class="n">FunctionTimer</span> <span class="n">fun_timer</span><span class="p">(</span><span class="s">"GBDT::TrainOneIter"</span><span class="p">,</span> <span class="n">global_timer</span><span class="p">);</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">init_scores</span><span class="p">(</span><span class="n">num_tree_per_iteration_</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
      <span class="c1">// boosting first</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">gradients</span> <span class="o">==</span> <span class="n">nullptr</span> <span class="o">||</span> <span class="n">hessians</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cur_tree_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cur_tree_id</span> <span class="o">&lt;</span> <span class="n">num_tree_per_iteration_</span><span class="p">;</span> <span class="o">++</span><span class="n">cur_tree_id</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">init_scores</span><span class="p">[</span><span class="n">cur_tree_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoostFromAverage</span><span class="p">(</span><span class="n">cur_tree_id</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">Boosting</span><span class="p">();</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="n">gradients_pointer_</span><span class="p">;</span>
        <span class="n">hessians</span> <span class="o">=</span> <span class="n">hessians_pointer_</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// use customized objective function</span>
        <span class="n">CHECK</span><span class="p">(</span><span class="n">objective_function_</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_sample_strategy_</span><span class="o">-&gt;</span><span class="n">IsHessianChange</span><span class="p">())</span> <span class="p">{</span>
          <span class="c1">// need to copy customized gradients when using GOSS</span>
          <span class="kt">int64_t</span> <span class="n">total_size</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">num_data_</span><span class="p">)</span> <span class="o">*</span> <span class="n">num_tree_per_iteration_</span><span class="p">;</span>
          <span class="cp">#pragma omp parallel for schedule(static)
</span>          <span class="k">for</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">total_size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">gradients_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">hessians_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hessians</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
          <span class="p">}</span>
          <span class="n">CHECK_EQ</span><span class="p">(</span><span class="n">gradients_pointer_</span><span class="p">,</span> <span class="n">gradients_</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
          <span class="n">CHECK_EQ</span><span class="p">(</span><span class="n">hessians_pointer_</span><span class="p">,</span> <span class="n">hessians_</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
          <span class="n">gradients</span> <span class="o">=</span> <span class="n">gradients_pointer_</span><span class="p">;</span>
          <span class="n">hessians</span> <span class="o">=</span> <span class="n">hessians_pointer_</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

            <span class="kt">void</span> <span class="n">GBDT</span><span class="o">::</span><span class="n">Boosting</span><span class="p">()</span> <span class="p">{</span>
              <span class="n">Common</span><span class="o">::</span><span class="n">FunctionTimer</span> <span class="n">fun_timer</span><span class="p">(</span><span class="s">"GBDT::Boosting"</span><span class="p">,</span> <span class="n">global_timer</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">objective_function_</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Log</span><span class="o">::</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"No objective function provided"</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="c1">// objective function will calculate gradients and hessians</span>
              <span class="kt">int64_t</span> <span class="n">num_score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="n">objective_function_</span><span class="o">-&gt;</span>
                <span class="n">GetGradients</span><span class="p">(</span><span class="n">GetTrainingScore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_score</span><span class="p">),</span> <span class="n">gradients_pointer_</span><span class="p">,</span> <span class="n">hessians_pointer_</span><span class="p">);</span>
            <span class="p">}</span>
              <span class="kt">void</span> <span class="n">GetGradients</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">score</span><span class="p">,</span> <span class="n">score_t</span><span class="o">*</span> <span class="n">gradients</span><span class="p">,</span> <span class="n">score_t</span><span class="o">*</span> <span class="n">hessians</span><span class="p">)</span> <span class="k">const</span> <span class="n">override</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">need_train_</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">weights_</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
                  <span class="cp">#pragma omp parallel for schedule(static)
</span>                  <span class="k">for</span> <span class="p">(</span><span class="n">data_size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_data_</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// get label and label weights</span>
                    <span class="k">const</span> <span class="kt">int</span> <span class="n">is_pos</span> <span class="o">=</span> <span class="n">is_pos_</span><span class="p">(</span><span class="n">label_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                    <span class="k">const</span> <span class="kt">int</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label_val_</span><span class="p">[</span><span class="n">is_pos</span><span class="p">];</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="n">label_weight</span> <span class="o">=</span> <span class="n">label_weights_</span><span class="p">[</span><span class="n">is_pos</span><span class="p">];</span>
                    <span class="c1">// calculate gradients and hessians</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="n">response</span> <span class="o">=</span> <span class="o">-</span><span class="n">label</span> <span class="o">*</span> <span class="n">sigmoid_</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">exp</span><span class="p">(</span><span class="n">label</span> <span class="o">*</span> <span class="n">sigmoid_</span> <span class="o">*</span> <span class="n">score</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="n">abs_response</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
                    <span class="n">gradients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">score_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">response</span> <span class="o">*</span> <span class="n">label_weight</span><span class="p">);</span>
                    <span class="n">hessians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">score_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">abs_response</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigmoid_</span> <span class="o">-</span> <span class="n">abs_response</span><span class="p">)</span> <span class="o">*</span> <span class="n">label_weight</span><span class="p">);</span>
                  <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</code></pre></div></div> <h2 id="training-code-snipet">Training code snipet</h2> <p>python</p> <p>c</p> <h2 id="csrcompressed-sparsed-row-format">CSR(Compressed Sparsed Row) format</h2> <p>It uses three one dimensional arrays to store non-zero values. This is efficient for sparse matrixes where most of the elements are zero.</p> <p>In the context of a Compressed Sparse Row (CSR) matrix, <code class="language-plaintext highlighter-rouge">indptr</code> and <code class="language-plaintext highlighter-rouge">indices</code> are arrays used to represent sparse data. Here’s what they mean:</p> <ul> <li> <p><code class="language-plaintext highlighter-rouge">indptr</code>: This is short for “index pointer”. It is an integer array of length <code class="language-plaintext highlighter-rouge">n_rows + 1</code> where <code class="language-plaintext highlighter-rouge">n_rows</code> is the number of rows in your matrix. The <code class="language-plaintext highlighter-rouge">indptr</code> array defines the index ranges for rows of the matrix. If <code class="language-plaintext highlighter-rouge">indptr[i] = x</code> and <code class="language-plaintext highlighter-rouge">indptr[i+1] = y</code>, this means that the data for row <code class="language-plaintext highlighter-rouge">i</code> in the matrix is stored in <code class="language-plaintext highlighter-rouge">indices[x:y]</code> and <code class="language-plaintext highlighter-rouge">data[x:y]</code>.</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">indices</code>: This is an integer array that contains column indices of non-zero elements. The column indices for row <code class="language-plaintext highlighter-rouge">i</code> are stored in <code class="language-plaintext highlighter-rouge">indices[indptr[i]:indptr[i+1]]</code>.</p> </li> </ul> <p>Here’s a simple example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>

<span class="c1"># Create a CSR matrix
</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">indptr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">csr</span> <span class="o">=</span> <span class="nf">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">indptr</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">csr</span><span class="p">.</span><span class="nf">toarray</span><span class="p">())</span>
</code></pre></div></div> <p>This will output:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]]</span>
</code></pre></div></div> <p>In this matrix, the non-zero elements of the first row are <code class="language-plaintext highlighter-rouge">1</code> (at column <code class="language-plaintext highlighter-rouge">0</code>) and <code class="language-plaintext highlighter-rouge">2</code> (at column <code class="language-plaintext highlighter-rouge">2</code>), which corresponds to <code class="language-plaintext highlighter-rouge">indices[0:2]</code> and <code class="language-plaintext highlighter-rouge">data[0:2]</code>. The non-zero elements of the second row are <code class="language-plaintext highlighter-rouge">3</code> (at column <code class="language-plaintext highlighter-rouge">2</code>), which corresponds to <code class="language-plaintext highlighter-rouge">indices[2:3]</code> and <code class="language-plaintext highlighter-rouge">data[2:3]</code>. The non-zero elements of the third row are <code class="language-plaintext highlighter-rouge">4</code> (at column <code class="language-plaintext highlighter-rouge">0</code>), <code class="language-plaintext highlighter-rouge">5</code> (at column <code class="language-plaintext highlighter-rouge">1</code>), and <code class="language-plaintext highlighter-rouge">6</code> (at column <code class="language-plaintext highlighter-rouge">2</code>), which corresponds to <code class="language-plaintext highlighter-rouge">indices[3:6]</code> and <code class="language-plaintext highlighter-rouge">data[3:6]</code>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/learning-based-memory-allocation-for-c-server-workloads-summary/">Learning-based memory allocation for C++ server workloads summary</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/my-question/">my question:</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/binary-search-algorithm-variant/">Binary search algorithm variant</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/docker-rocksdb-build/">Docker Rocksdb build</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/difference-between-dockerfile-and-docker-compose/">Difference between Dockerfile and Docker Compose</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zhutao Zhuang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: October 24, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let theme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===theme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"post-cs149-lecture7-cuda",title:"Cs149 Lecture7 Cuda",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-lecture7-cuda/"}},{id:"post-cs149-assign2",title:"Cs149 Assign2",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-assign2/"}},{id:"post-cs149-assign1-prog5",title:"Cs149 Assign1 Prog5",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-assign1-prog5/"}},{id:"post-cs149-assign1-prog4",title:"Cs149 Assign1 Prog4",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-assign1-prog4/"}},{id:"post-cs149-assign1-prog3",title:"Cs149 Assign1 Prog3",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-assign1-prog3/"}},{id:"post-parallel-programming-simd-intrinsics",title:"Parallel programming - SIMD intrinsics",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cs149-assign1-prog2/"}},{id:"post-stf-cs149-lecture-takeaway",title:"Stf Cs149 Lecture Takeaway",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/stf-cs149-lecture-takeaway/"}},{id:"post-parallel-programming-round-robin-assignment",title:"Parallel programming - round robin assignment",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/stf-cs149-parallel-programming-assignment1/"}},{id:"post-ssh-display-image-on-local-server",title:"ssh display image on local server",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/ssh-display-img/"}},{id:"post-c-compiler-single-letter-local-variable",title:"C compiler - single letter local variable",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/chibicc-single-letter-ident/"}},{id:"post-c-compiler-parse-example-walkthrough",title:"C compiler - parse example walkthrough",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/statement-and-comparison/"}},{id:"post-linux-get-cpu-time-and-wall-clock-time",title:"Linux get cpu time and wall clock time",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/get-function-cpu-time/"}},{id:"post-simple-c-compiler-unary",title:"Simple c compiler unary",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/chibicc-unary/"}},{id:"post-simple-c-compiler-gen-expr",title:"Simple c compiler gen expr",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/chibicc-gen-expr/"}},{id:"post-python-pyplot-trick",title:"Python pyplot trick",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/python-plot-trick/"}},{id:"post-simple-lru-cache-cpp-implementation",title:"Simple lru cache cpp implementation",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/lru-cache/"}},{id:"post-python-capture-function-print-output",title:"Python capture function print output",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/capture-output-python/"}},{id:"post-simple-c-compiler",title:"Simple c compiler",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/chibicc-compiler/"}},{id:"post-calloc-and-malloc",title:"calloc and malloc",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/calloc/"}},{id:"post-lightgbm-dataset",title:"LightGBM dataset",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/lightgbm-dataset/"}},{id:"post-difference-between-deep-copy-and-shallow-copy-in-python",title:"Difference between deep copy and shallow copy in python",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/python-deep-copy/"}},{id:"post-python-package-path",title:"Python Package Path",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/python-package-path/"}},{id:"post-micrograd",title:"micrograd",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/micrograd/"}},{id:"post-cpp-thread-local",title:"cpp thread local",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cpp-thread-local/"}},{id:"post-cpp-async",title:"cpp async",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cpp-async/"}},{id:"post-python-dataframe-drop-row",title:"python dataframe drop row",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/df-drop-row/"}},{id:"post-git-merge-file-from-another-branch",title:"Git merge file from another branch",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/git-merge-file-from-another-branch/"}},{id:"post-efficiency-tips",title:"Efficiency tips",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/efficiency-tips/"}},{id:"post-speed-up-matrix-multiplication",title:"Speed up matrix multiplication",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/matrix-multiplication/"}},{id:"post-how-to-write-research-paper",title:"How to write research paper",description:"How to write research paper",section:"Posts",handler:()=>{window.location.href="/blog/2024/how-to-write-research-paper/"}},{id:"post-fast-nano-gpt-training",title:"Fast nano-gpt training",description:"llm",section:"Posts",handler:()=>{window.location.href="/blog/2024/gpt-fast/"}},{id:"post-system-for-machine-learning-papers",title:"System for machine learning papers",description:"sysml papers",section:"Posts",handler:()=>{window.location.href="/blog/2024/sysml-papers/"}},{id:"post-nano-gpt-and-transformer",title:"nano-gpt and Transformer",description:"llm",section:"Posts",handler:()=>{window.location.href="/blog/2024/transformer/"}},{id:"post-pytorch-tensor-to",title:"pytorch tensor.to",description:"pytorch",section:"Posts",handler:()=>{window.location.href="/blog/2024/pytorch/"}},{id:"post-install-neovim-with-old-glibc",title:"Install neovim with old glibc",description:"vim",section:"Posts",handler:()=>{window.location.href="/blog/2024/install-neovim/"}},{id:"post-llm-c",title:"llm.c",description:"llm minikune",section:"Posts",handler:()=>{window.location.href="/blog/2024/llm-c/"}},{id:"post-basic-digital-electronic",title:"Basic digital electronic",description:"transistor",section:"Posts",handler:()=>{window.location.href="/blog/2024/digital-electronic/"}},{id:"post-k8s-advance",title:"K8s Advance",description:"k8s minikune",section:"Posts",handler:()=>{window.location.href="/blog/2024/k8s-advance/"}},{id:"post-difference-between-dockerfile-and-docker-compose",title:"Difference between Dockerfile and Docker Compose",description:"",section:"Posts",handler:()=>{window.open("https://bilyz.medium.com/difference-between-dockerfile-and-docker-compose-d6ebdc687785?source=rss-da1663a42461------2","_blank")}},{id:"post-docker-rocksdb-build",title:"Docker Rocksdb build",description:"",section:"Posts",handler:()=>{window.open("https://bilyz.medium.com/docker-rocksdb-build-18a0bf0e0bb0?source=rss-da1663a42461------2","_blank")}},{id:"post-k3s-beginner",title:"K3s beginner",description:"k3s",section:"Posts",handler:()=>{window.location.href="/blog/2024/k3s/"}},{id:"post-docker-rocksdb",title:"Docker RocksDB",description:"cloud",section:"Posts",handler:()=>{window.location.href="/blog/2024/docker-rocksdb/"}},{id:"post-docker-beginner",title:"Docker beginner",description:"cloud",section:"Posts",handler:()=>{window.location.href="/blog/2024/docker-file-compose-diff/"}},{id:"post-git",title:"Git",description:"git",section:"Posts",handler:()=>{window.location.href="/blog/2024/git/"}},{id:"post-lightgbm-usage-and-implementation",title:"LightGBM usage and implementation",description:"Artificial Intelligence",section:"Posts",handler:()=>{window.location.href="/blog/2024/lightgbm-usage/"}},{id:"post-backpropogation-c-implementation",title:"Backpropogation C++ Implementation",description:"Artificial Intelligence",section:"Posts",handler:()=>{window.location.href="/blog/2024/back-propagation/"}},{id:"post-conda-usage",title:"Conda usage",description:"Artificial Intelligence",section:"Posts",handler:()=>{window.location.href="/blog/2024/conda/"}},{id:"post-install-k8s-cluster-with-3-ubuntu-nodes",title:"Install K8s cluster with 3 ubuntu nodes",description:"cloud",section:"Posts",handler:()=>{window.location.href="/blog/2024/cloud/"}},{id:"post-convert-svg-figures-to-pdf-latex-before-submitting-to-arxiv",title:"Convert SVG figures to pdf_latex before submitting to arxiv",description:"Convert SVG figures to pdf_latex before submitting to arxiv",section:"Posts",handler:()=>{window.location.href="/blog/2024/arxiv-cleaner/"}},{id:"post-binary-search-algorithm-variant",title:"Binary search algorithm variant",description:"",section:"Posts",handler:()=>{window.open("https://bilyz.medium.com/binary-search-algorithm-variant-9b5310473471?source=rss-da1663a42461------2","_blank")}},{id:"post-my-question",title:"my question:",description:"",section:"Posts",handler:()=>{window.open("https://bilyz.medium.com/my-question-a69930f167f0?source=rss-da1663a42461------2","_blank")}},{id:"post-learning-based-memory-allocation-for-c-server-workloads-summary",title:"Learning-based memory allocation for C++ server workloads summary",description:"",section:"Posts",handler:()=>{window.open("https://bilyz.medium.com/learning-based-memory-allocation-for-c-server-workloads-summary-479e9cd6d6f6?source=rss-da1663a42461------2","_blank")}},{id:"post-a-post-with-formatting-and-links",title:"a post with formatting and links",description:"march &amp; april, looking forward to summer",section:"Posts",handler:()=>{window.location.href="/blog/2015/formatting-and-links/"}},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%7A%68%75%61%6E%67%7A%68%75%74%61%6F@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/BilyZ98","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>